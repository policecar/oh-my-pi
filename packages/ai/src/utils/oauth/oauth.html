<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Authentication</title>
		<style>
			:root {
				--bg: #09090b;
				--card-bg: #18181b;
				--text-main: #fafafa;
				--text-muted: #a1a1aa;
				--success: #22c55e;
				--error: #ef4444;
				--border: #27272a;
			}
			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
				background-color: var(--bg);
				color: var(--text-main);
				display: flex;
				align-items: center;
				justify-content: center;
				height: 100vh;
				margin: 0;
				overflow: hidden;
			}
			.container {
				background: var(--card-bg);
				border: 1px solid var(--border);
				border-radius: 12px;
				padding: 2.5rem;
				width: 100%;
				max-width: 400px;
				text-align: center;
				box-shadow:
					0 20px 25px -5px rgba(0, 0, 0, 0.1),
					0 10px 10px -5px rgba(0, 0, 0, 0.04);
				opacity: 0;
				transform: translateY(10px);
				animation: fadeIn 0.4s ease-out forwards;
			}
			@keyframes fadeIn {
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
			.icon-circle {
				position: relative;
				width: 64px;
				height: 64px;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				margin: 0 auto 1.5rem;
				background: rgba(255, 255, 255, 0.05);
			}
			.icon {
				width: 32px;
				height: 32px;
				z-index: 2;
			}
			.timer-svg {
				position: absolute;
				top: -2px;
				left: -2px;
				width: 68px;
				height: 68px;
				transform: rotate(-90deg);
				z-index: 1;
				pointer-events: none;
			}
			.timer-circle {
				fill: none;
				stroke-width: 2;
				stroke-linecap: round;
				stroke-dasharray: 201;
				stroke-dashoffset: 0;
			}
			.countdown .timer-circle {
				animation: countdown 3s linear forwards;
			}
			@keyframes countdown {
				to {
					stroke-dashoffset: 201;
				}
			}
			h1 {
				font-size: 1.5rem;
				font-weight: 600;
				margin: 0 0 0.75rem;
				letter-spacing: -0.025em;
			}
			p {
				color: var(--text-muted);
				line-height: 1.5;
				margin: 0 0 1.5rem;
				font-size: 0.95rem;
			}
			.btn {
				display: inline-block;
				background: var(--text-main);
				color: var(--bg);
				font-weight: 500;
				padding: 0.6rem 1.2rem;
				border-radius: 6px;
				text-decoration: none;
				font-size: 0.9rem;
				transition: opacity 0.2s;
				cursor: pointer;
				border: none;
			}
			.btn:hover {
				opacity: 0.9;
			}

			/* State: success */
			.success .icon-circle {
				background: rgba(34, 197, 94, 0.1);
			}
			.success .icon {
				color: var(--success);
			}
			.success .timer-circle {
				stroke: var(--success);
			}
			.success .icon-error {
				display: none;
			}

			/* State: error */
			.error .icon-circle {
				background: rgba(239, 68, 68, 0.1);
			}
			.error .icon {
				color: var(--error);
			}
			.error .timer-circle {
				stroke: var(--error);
			}
			.error .icon-success,
			.error .timer-svg {
				display: none;
			}
		</style>
	</head>
	<body>
		<div id="app" class="container">
			<div class="icon-circle">
				<svg class="timer-svg" viewBox="0 0 68 68">
					<circle class="timer-circle" cx="34" cy="34" r="32"></circle>
				</svg>
				<svg class="icon icon-success" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
					<path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
				</svg>
				<svg class="icon icon-error" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
					<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
				</svg>
			</div>
			<h1 id="title">Authentication</h1>
			<p id="message"></p>
			<button onclick="window.close()" class="btn">Close Window</button>
		</div>

		<script id="server-state" type="application/json">
			__OAUTH_STATE__
		</script>

		<script>
			let serverState;
			try {
				serverState = JSON.parse(document.getElementById("server-state").textContent);
			} catch {
				const params = new URLSearchParams(window.location.search);
				serverState = {
					ok: params.get("ok") === "1",
					error: params.get("error") || "Authentication failed",
				};
			}

			const app = document.getElementById("app");
			const title = document.getElementById("title");
			const message = document.getElementById("message");

			if (serverState.ok) {
				app.classList.add("success", "countdown");
				title.textContent = "Authentication Successful";
				message.innerHTML = "You have successfully logged in.<br>This window will close automatically.";
				setTimeout(() => window.close(), 3000);
			} else {
				app.classList.add("error");
				title.textContent = "Authentication Failed";
				message.textContent = serverState.error || "An error occurred";
			}
		</script>
	</body>
</html>
